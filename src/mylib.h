/*===========================================================================
 * mylib.h - 个人代码库头文件
 * 
 * 描述：包含常用的单片机函数和宏定义
 * 作者：hysin
 * 日期：2026-01-12
 *===========================================================================*/

#ifndef MYLIB_H
#define MYLIB_H

#include <8052.h>
// #include <8051.h>

// SDCC 内置函数
#define _nop_() __asm nop __endasm
#define interrupt(x) __interrupt(x)

/*---------------------------------------------------------------------------
 * 系统配置
 *---------------------------------------------------------------------------*/
#define FOSC 11059200L  // 晶振频率 (Hz)
#define MCU_12T         // STC89C51RD 是 12T 传统型单片机 (1 机器周期 = 12 时钟周期)
                        // 增强型如 STC89C516RD 是 1T (1 机器周期 = 1 时钟周期)

/*---------------------------------------------------------------------------
 * 延时函数
 *---------------------------------------------------------------------------*/

/**
 * @brief 延时指定的毫秒数（软件延时，精度一般）
 * @param ms 延时时间（毫秒）
 * @note STC89C51RD 是 12T 传统型单片机 @ 11.0592MHz
 */
void delay_ms(unsigned int ms);

/**
 * @brief 延时指定的微秒数（软件延时，精度有限）
 * @param us 延时时间（微秒）
 * @note 精度有限，建议用于 us >= 5 的情况
 */
void delay_us(unsigned int us);

/**
 * @brief 初始化定时器0用于精确延时
 * @note 使用定时器0，工作模式1（16位定时器）
 *       配置为1ms中断，提供精确的时基
 */
void timer0_init(void);

/**
 * @brief 精确延时指定毫秒数（基于定时器中断）
 * @param ms 延时时间（毫秒）
 * @note 需要先调用 timer0_init() 初始化
 *       精度：±1个定时器周期（非常精确）
 */
void delay_ms_precise(unsigned int ms);

/*---------------------------------------------------------------------------
 * 在这里添加你的其他函数声明
 *---------------------------------------------------------------------------*/

// 示例：
// void my_function(void);
// unsigned char get_value(void);

/// @brief 点亮特定位置的LED
/// @param led_list 传入一个列表，索引为对应灯（灯号 = 索引+1），值=1为亮，0为灭
void setLEDs(unsigned char led_list[8]) ;


/// @brief 检测哪个独立按键有被按下（需要配合while使用）
/// @param  
/// @return 返回扫描到的按下的按钮（K1 - 1， K2 - 2， ……）
unsigned char key_scan(void) ;

/// @brief 将char（8位的数）转换为列表（相同的顺序）
/// @param LEDset 传入列表的指针
/// @param num 那个八位数的指针
void tran_num_to_LEDset(unsigned char *LEDset, char *num);

#endif // MYLIB_H
